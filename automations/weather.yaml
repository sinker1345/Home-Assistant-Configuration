# This (trigger) has to happen, while condition(s) are true, to do stuff (action)

  - alias: 'NWS Weather Alert Pop Up Control'
    trigger:
      platform: state
      entity_id: sensor.nws_alert_count_filtered
    condition:
      - condition: template  
        value_template: '{{states.sensor.nws_alert_count_filtered.state | int > 0}}'
    action:
      service: script.nws_popup_on_wx_alert
    
  - alias: NWS Notification Weather Alert
    trigger:
      platform: state
      entity_id: sensor.nws_alert_count_filtered
    condition:
      - condition: template
        value_template: '{{states.sensor.nws_alert_count_filtered.state | int > 0}}'
    action:
      - service: notify.google_push
        data_template:
          message: "NWS: {{ states.sensor.nws_alert_event_filtered.state }}"
          target: ["Tommy_Pixel_2XL","MPU_Linux", "MPU_Chrome"]
          data:
           image: !secret weather_image
           url: !secret weather_image
        
  - alias: NWS Announcement Weather Alert
    initial_state: 'on'
    trigger:
      - platform: state
        entity_id: sensor.nws_alert_count_filtered
    condition:
      condition: and
      conditions:
        - condition: template
          value_template: '{{states.sensor.nws_alert_count_filtered.state | int > 0}}'
        - condition: template
          value_template: "{{ (('Severe' in states.sensor.nws_alert_event_filtered.state) or ('Tornado' in states.sensor.nws_alert_event_filtered.state)) and 'Warning' in states.sensor.nws_alert_event_filtered.state }}"
    action:
      #- service: media_player.volume_set
      #  data:
      #    entity_id:
      #      - media_player.computer_room_dot
      #      - media_player.kitchen_dot
      #      - media_player.livingroom_dot
      #      - media_player.master_bedroom_dot
      #    volume_level: 0.9
      - service: tts.google_say
        data_template:
          entity_id: 
            - media_player.common_area
          message: "Attention!,,,Attention!,,,The National Weather Service has issued a 
        {{ states.sensor.nws_alert_event_filtered.state }} for your area. 
        It expires at {{ as_timestamp(state_attr('sensor.nws_alert_event_raw', 'features')[0].properties.expires)| timestamp_custom('%-I:%M %p on %-m-%-d-%Y') }}."
      - delay: '00:00:10'
      - service: tts.google_say
        data_template:
          entity_id: 
            - media_player.common_area
          message: "Attention!,,,Attention!,,,The National Weather Service has issued a 
        {{ states.sensor.nws_alert_event_filtered.state }} for your area. 
        It expires at {{ as_timestamp(state_attr('sensor.nws_alert_event_raw', 'features')[0].properties.expires)| timestamp_custom('%-I:%M %p on %-m-%-d-%Y') }}."

  - alias: NWS Announcement Weather Alert 2
    initial_state: 'on'
    trigger:
      - platform: state
        entity_id: sensor.nws_alert_count_filtered
    condition:
      condition: and
      conditions:
        - condition: template
          value_template: '{{states.sensor.nws_alert_count_filtered.state | int > 1}}'
        - condition: template
          value_template: "{{ (('Severe' in states.sensor.nws_alert_event_2.state) or ('Tornado' in states.sensor.nws_alert_event_2.state)) and 'Warning' in states.sensor.nws_alert_event_2.state }}"
    action:
      #- service: media_player.volume_set
      #  data:
      #    entity_id:
      #      - media_player.computer_room_dot
      #      - media_player.kitchen_dot
      #      - media_player.livingroom_dot
      #      - media_player.master_bedroom_dot
      #    volume_level: 0.9
      - service: tts.google_say
        data_template:
          entity_id: 
            - media_player.common_area
          message: "Attention!,,,Attention!,,,A second severe weather alert has been issued. The National Weather Service has issued a 
        {{ states.sensor.nws_alert_event_2.state }} for your area. 
        It expires at {{ as_timestamp(state_attr('sensor.nws_alert_event_raw', 'features')[1].properties.expires)| timestamp_custom('%-I:%M %p on %-m-%-d-%Y') }}."
      - delay: '00:00:10'
      - service: tts.google_say
        data_template:
          entity_id: 
            - media_player.common_area
          message: "Attention!,,,Attention!,,,A second severe weather alert has been issued. The National Weather Service has issued a 
        {{ states.sensor.nws_alert_event_2.state }} for your area. 
        It expires at {{ as_timestamp(state_attr('sensor.nws_alert_event_raw', 'features')[1].properties.expires)| timestamp_custom('%-I:%M %p on %-m-%-d-%Y') }}."
    
  - alias: NWS Announcement Weather Alert for MBR
    initial_state: 'on'
    trigger:
      - platform: state
        entity_id: sensor.nws_alert_count_filtered
    condition:
      condition: and
      conditions:
        - condition: template
          value_template: '{{states.sensor.nws_alert_count_filtered.state | int > 0}}'
        - condition: template
          value_template: "{{ 'Tornado' in states.sensor.nws_alert_event_filtered.state and 'Warning' in states.sensor.nws_alert_event_filtered.state }}"
    action:
      #- service: media_player.volume_set
      #  data:
      #    entity_id:
      #      - media_player.computer_room_dot
      #      - media_player.kitchen_dot
      #      - media_player.livingroom_dot
      #      - media_player.master_bedroom_dot
      #    volume_level: 0.9
      - service: tts.google_say
        data_template:
          entity_id: 
            - media_player.master_bath
          message: "Warning!,,,Warning!,,,The National Weather Service has issued a 
        {{ states.sensor.nws_alert_event_filtered.state }} for your area. 
        It expires at {{ as_timestamp(state_attr('sensor.nws_alert_event_raw', 'features')[0].properties.expires)| timestamp_custom('%-I:%M %p on %-m-%-d-%Y') }}."
      - delay: '00:00:10'
      - service: tts.google_say
        data_template:
          entity_id: 
            - media_player.master_bath
          message: "Warning!,,,Warning!,,,The National Weather Service has issued a 
        {{ states.sensor.nws_alert_event_filtered.state }} for your area. 
        It expires at {{ as_timestamp(state_attr('sensor.nws_alert_event_raw', 'features')[0].properties.expires)| timestamp_custom('%-I:%M %p on %-m-%-d-%Y') }}."
          
  - alias: NWS Announcement Weather Alert 2 for MBR
    initial_state: 'on'
    trigger:
      - platform: state
        entity_id: sensor.nws_alert_count_filtered
    condition:
      condition: and
      conditions:
        - condition: template
          value_template: '{{states.sensor.nws_alert_count_filtered.state | int > 1}}'
        - condition: template
          value_template: "{{ 'Tornado' in states.sensor.nws_alert_event_2.state and 'Warning' in  states.sensor.nws_alert_event_2.state }}"
    action:
      #- service: media_player.volume_set
      #  data:
      #    entity_id:
      #      - media_player.computer_room_dot
      #      - media_player.kitchen_dot
      #      - media_player.livingroom_dot
      #      - media_player.master_bedroom_dot
      #    volume_level: 0.9
      - service: tts.google_say
        data_template:
          entity_id: 
            - media_player.master_bath
          message: "Warning!,,,Warning!,,,A second severe weather alert has been issued. The National Weather Service has issued a 
        {{ states.sensor.nws_alert_event_2.state }} for your area. 
        It expires at {{ as_timestamp(state_attr('sensor.nws_alert_event_raw', 'features')[1].properties.expires)| timestamp_custom('%-I:%M %p on %-m-%-d-%Y') }}."
      - delay: '00:00:10'
      - service: tts.google_say
        data_template:
          entity_id: 
            - media_player.master_bath
          message: "Warning!,,,Warning!,,,A second severe weather alert has been issued. The National Weather Service has issued a 
        {{ states.sensor.nws_alert_event_2.state }} for your area. 
        It expires at {{ as_timestamp(state_attr('sensor.nws_alert_event_raw', 'features')[1].properties.expires)| timestamp_custom('%-I:%M %p on %-m-%-d-%Y') }}."